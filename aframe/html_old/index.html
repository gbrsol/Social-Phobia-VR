<!DOCTYPE html>
<html lang = "pt-br">
  <head>
      <title>Fobia Social VR</title>
      <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
      
      <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
      <script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js"></script>
      <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
      <script src="scripts.js"></script>
      <script src="imports/progressive-controls.js"></script>
      <script src="imports/anime-master/lib/anime.es.js"></script>
      <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
      <script src="https://rawgit.com/mayognaise/aframe-gif-component/master/dist/aframe-gif-component.min.js"></script>
      <script src="imports/aframe-inspector-plugin-recast-master/public/aframe-inspector-plugin-recast.js"></script>
      <script src="https://unpkg.com/aframe-aabb-collider-component@3.1.0/dist/aframe-aabb-collider-component.min.js"></script>
      <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
      
      <script>
          AFRAME.registerComponent('pause',{
              init:function(){
                  var el = document.querySelector('#bt-pause');
                  el.addEventListener('click',function(){
                     var els = el.sceneEl.querySelectorAll('*');
                      for(var i = 0; i < els.length;i++)
                          els[i].components.pause();//els[i].setAttribute('animation-mixer',{timescale:0});
                  });
              /*this.el.addEventListener('click',function(){
                  var els = this.el.sceneEl.querySelectorAll('*');
                    for (var i = 0; i < els.length; i++) {
                      els[i].setAttribute('animation-mixer',{timescale: 0});
                    }*/
              }
          }
          );
          AFRAME.registerComponent('play',{
              init:function(){
                  var el = document.querySelector('#bt-play');
                  var balao = document.querySelector('#balao');
                  balao.pause();
                  el.addEventListener('click',function(){
                     var els = el.sceneEl.querySelectorAll('*');
                      for(var i = 0; i < els.length;i++)
                          els[i].components.play();//els[i].setAttribute('animation-mixer',{timescale:0});
                  });
          } 
          });
        AFRAME.registerComponent('transition',{
            init: function()
            {
                var el = document.querySelector('#bt-avancar');
                el.addEventListener('click',function(){
                    var ele = document.querySelector('#fundo');
                    ele.emit('click');
                });
            }
        });
        AFRAME.registerComponent('anjo',{
            schema:{
                fala:{type:'selector', default:'#intro_anjo'}
            },
            init: function(){
                var el = this.el;
                var data = this.data;
                el.addEventListener('sound-ended',function(){
                    el.fala = getNextSound();
            }
            
        )}});
        AFRAME.registerComponent("transicao-clinica",{
            init: function()
            {
                var el = this.el;
                var pos = new THREE.Vector3();
                var clinico = document.querySelector('#clinico');
                var novo = document.querySelector('#novo');
                var player = document.querySelector('#rig');
                var anjo = document.querySelector('#anjo');
                var tunel = document.querySelector('#fundo');
                novo.object3D.getWorldPosition(pos);
                tunel.setAttribute('blink-teleportation',{dur:800, pos:pos});
                el.addEventListener('click',function()
                {
                        
                        var abs = clinico.getAttribute('position');
                        var rel = novo.getAttribute('position');
                        var pos = player.getAttribute('position');
                        pos.x = abs.x + rel.x;
                        pos.y = abs.y + rel.y-1.6;
                        pos.z = abs.z + rel.z;
                        //tunel.emit('blink');
                        //novo.setAttribute('goto','dur',100);
                        //novo.emit('click');
                        //ceu.setAttribute('color','#173030');
                        
                        setTimeout(function(){ceu.components.sound.playSound()},300);
                        //novo.emit('click');
                        setTimeout(function(){
                            anjo.emit('pergunta');
                            anjo.setAttribute('visible',true);
                        },6000);
                });
            }
        });
        AFRAME.registerComponent('ativa_anjo',{
            init: function()
            {
                //el.components.sound.playSound(fala(this.message));
                var anjo = document.querySelector('#anjo');
                this.el.addEventListener('click',function(){
                    if(anjo.getAttribute('visible') == false)
                        {
                            anjo.setAttribute('visible',true);
                            anjo.components.sound.playSound();
                        }
                    else
                        {
                            anjo.setAttribute('visible',false);
                        }
                });
                anjo.addEventListener('sound-ended',function(){
                    anjo.setAttribute('sound','#anjo_f1');
                });
            }
        });
        AFRAME.registerComponent('button',{
            init: function()
            {
                var pos = this.el.getAttribute('position');
                //animation__click="property:position;startEvents:click;dur:200;to:0.1 -0.05 0.55;dir:alternate;easing:linear;loop:1;"
                this.el.setAttribute('animation',{ property:"position", startEvents: "click", dur: 200, to: {x:pos.x, y:pos.y-0.02, z:pos.z}, dir:'alternate',easing: 'linear',loop:1});
            }
        });
        AFRAME.registerComponent('gif-portal',{
            init: function()
            {
                var el = this.el;
                var data = this.data;
                el.setAttribute('material',{shader:'gif',src:"url(/textures/portal.gif)"});
                el.play();
            }
        });
        AFRAME.registerComponent('muda-cor-balao',{
            init: function()
            {
                var el = document.querySelector('#bt-cor');
                var balao = document.querySelector('#balao');
                el.addEventListener('click',function(){
                    var randomHEX = '#'+Math.random().toString(16).substr(-6);
                    balao.setAttribute('material','color',randomHEX);
                });
            }
        }); 
        AFRAME.registerComponent('npc',{
            schema:{name:String, default:"TPose"},
            init: function()
            {
                var el = document.querySelector('#prima');
                el.addEventListener('click',function(){
                    el.setAttribute('animation-mixer','clip',cycleAnim());
                });
                el.addEventListener('Walk',function(){
                    el.setAttribute('animation-mixer','clip',getAnim("Walk"))
                });
                el.addEventListener('Sit',function(){
                    el.setAttribute('animation-mixer','clip',getAnim("Sit"))
                });
                el.addEventListener('Idle',function(){
                    el.setAttribute('animation-mixer','clip',getAnim("Idle"))
                });
                el.addEventListener('Animate',function(){
                    el.setAttribute('animation-mixer','clip',getAnim(this.data.name));
                });
                el.addEventListener('walk-sit',function(){
                                el.emit('Sit');
                });
            }
        });
        AFRAME.registerComponent('npc-force-change',{
            init: function()
            {
                var pri = document.querySelector('#prima');
                this.el.addEventListener('click',function(){
                    pri.emit('click');
                });
            }
        });
        // use a system to keep a global track if we are already moving <- https://stackoverflow.com/questions/60856290/how-do-i-use-checkpoint-controls-in-a-frame
        AFRAME.registerSystem('goto', {
          init: function() {
            this.isMoving = false
          }
        })

        // this component will have the actual logic
        AFRAME.registerComponent('goto', {
            schema:{dur: 'number', default:300},
          init: function() {
             let camRig = document.querySelector('#rig');
             var data = this.data;
             var el = this.el;
             // upon click - move the camera
             el.addEventListener('click', e => {
                // check if we are already moving
                if (this.system.isMoving) return;

                // lock other attempts to move
                this.system.isMoving = true

                // grab the positions
                let targetPos = this.el.getAttribute("position")
                let rigPos = camRig.getAttribute("position")

                // set the animation attributes. 
                camRig.setAttribute("animation", {
                  "from": rigPos,
                  "to": AFRAME.utils.coordinates.stringify({x: targetPos.x, y: rigPos.y, z: targetPos.z}),
                  "dur": targetPos.distanceTo(rigPos) * 400,
                  "easing": "linear"
                })
                camRig.emit('go')
             })

             // when the animation is finished - update the "shared" variable
             camRig.addEventListener('animationcomplete', e=> {
               this.system.isMoving = false
             })
          }
        });
        AFRAME.registerComponent('ativa-portal', {
          init: function() {
             var portal = document.querySelector('#fundo');
             this.el.addEventListener('click',function(){
                     setTimeout(function(){
                         portal.classList.add('clickable');
                     }, 2000);
             });
          }
        });
        AFRAME.registerComponent('desativa-portal', {
          init: function() {
             var portal = document.querySelector('#fundo');
             this.el.addEventListener('click',function(){
                     portal.classList.remove('clickable');
             });
          }
        });
        AFRAME.registerComponent('blink-teleportation', {
	schema: {
		pos: {type: 'vec3'},
		dur: {type: 'number', default: 300}
	},
	
	init: function () {
		var el = this.el;
		var data = this.data;
		var camera = document.querySelector('#player');
		var cameraRig = document.querySelector('#rig');
		
		// CREATE A TRANSPARENT BLACK IMAGE
		var blink = document.createElement('a-image');
		blink.setAttribute('material', {
			color: '#000000',
			opacity: 0
		});
		
		// SET THE BLACK IMAGE POSITION AND APPEND IT AS CAMERA'S CHILD ENTITY
		blink.setAttribute('position', {x: 0, y: 0, z: -0.1});
		camera.appendChild(blink);
		
		// ON CLICK, ANIMATE THE BLACK IMAGE (FADE-IN)
		el.addEventListener('blink', function () {
			blink.setAttribute('animation', {
				property: 'material.opacity',
				from: 0,
				to: 1,
				dur: data.dur,
				easing: 'easeOutCubic'
			});
			
			// WHEN FADE-IN ANIMATION COMPLETES, MOVE THE CAMERA RIG TO DESTINATION
			setTimeout(function () {
				cameraRig.setAttribute('position', data.pos);
				// EMIT CUSTOM EVENT TO TRIGGER THE FADE-OUT ANIMATION
				el.emit('position-changed');
			}, data.dur+300);
		});
		
		// ON CUSTOM EVENT, ANIMATE THE BLACK IMAGE (FADE-OUT)
		el.addEventListener('position-changed', function () {
			blink.setAttribute('animation', {
				to: 0
			});
		  });
	       }
        });
        AFRAME.registerComponent('npc-handler',{
            schema:{animation: String, default: "TPOSE"},
            init: function()
            {
                var el = this.el;
                var data = this.data;
                el.addEventListener('click',function(){
                    var character = document.querySelector('#prima');
                    character.emit(data.animation);
                });
            }
        });
        AFRAME.registerComponent('processa-resposta',{
            init:function(){
                var el = document.querySelector('#anjo');
                el.addEventListener('positive',function(){
                    el.setAttribute('sound','src',getNextSound("positive"));
                    el.components.sound.playSound();
                });
                el.addEventListener('negative',function(){
                    el.setAttribute('sound','src',getNextSound("negative"));
                    el.components.sound.playSound();
                });
                el.addEventListener('pergunta',function(){
                    el.setAttribute('sound','src',getNextSound("question"));
                    el.components.sound.playSound();
                    el.emit('spawn-menu');
                });
                el.addEventListener('get-last-question', function(){
                    el.setAttribute('sound','src',getLastQuestion("question"));
                    el.components.sound.playSound();
                    el.emit('spawn-menu');
                });
                el.addEventListener('greet',function(){
                    el.setAttribute('sound','src','#intro_anjo');
                    el.components.sound.playSound();
                });
            }
        });
        AFRAME.registerComponent('ativa-porta',{
            init:function(){
                var el = this.el;
                var data=this.data;
                var eixo = document.querySelector('#door-axis');
                var porta = document.querySelector('#porta');
                var npc = document.querySelector('#prima');
                el.addEventListener('click',function(){
                    setTimeout(function(){
                        eixo.classList.add('clickable');
                        porta.classList.add('clickable');
                    },3000);
            });
        }
        });
        AFRAME.registerComponent('door-controls',
          {
              init:function(){
                        let eixo = document.querySelector('#door-axis');
                        let porta = document.querySelector('#porta');

                        porta.addEventListener('open',function(){
                                    eixo.setAttribute("animation",{property:"rotation",to:"0 -90 0",dur:3000});
                                  });
                        porta.addEventListener('close',function(){
                                    eixo.setAttribute("animation",{property:"rotation",to:"0 0 0",dur:3000});
                                    });
                    },
                update:function()
                {
                    let el = this.el;
                  let eixo = document.querySelector('#door-axis');
                  let porta = document.querySelector('#porta');
                  let npc = document.querySelector('#prima');
                  porta.classList.add('clickable');
                  porta.addEventListener('click',function(){
                      if(doorState)
                      {
                          doorState = !doorState;
                          porta.emit('open');
                      }
                      else(!doorState)
                      {
                            doorState = !doorState;
                            porta.emit('close');
                            if(!walked)
                                {
                                    setTimeout(function(){
                                        npc.emit('Walk');
                                        setTimeout(function(){
                                            //npc.setAttribute('position',"-10.61058 -20 1.35262");
                                            npc.setAttribute('position',"-0.5 0 1.375");
                                            npc.setAttribute('rotation','0 180 0');
                                            npc.emit('Sit')
                                            walked = true;
                                        } ,800);
                                     },3000);
                                    
                                }
                        
                      }
                  });
                }
            }
          );
        AFRAME.registerComponent('emite-pergunta',{
            init:function(){
                var el = this.el;
                var data=this.data;
                var anjo = document.querySelector('#anjo');
                el.addEventListener('click',function(){
                    setTimeout(function(){
                        anjo.emit('pergunta');
                    },2000);
            });
        }
        });
        AFRAME.registerComponent('option-menu',{
            init:function()
            {
                var el = this.el;
                var anjo = document.querySelector('#anjo');
                var scene = document.querySelector('#cena');
                el.addEventListener('spawn-menu',function(){
                    var player = document.querySelector('#rig');
                    var posAnjo = new THREE.Vector3();
                    player.object3D.getWorldPosition(posAnjo);
                    var pos = {x: posAnjo.x,
                              y: posAnjo.y+1.6,
                              z: posAnjo.z-0.4};
                    var pSim = document.createElement('a-box');
                    var pNao = document.createElement('a-box');
                    var pRep = document.createElement('a-box');
                    
                    pSim.setAttribute('visible',true);
                    pSim.setAttribute('id','op_sim');
                    pSim.setAttribute('scale',"0.04 0.04 0.04");
                    //pSim.setAttribute('material','color','#00FFFF');
                    pSim.setAttribute('src','#thumbs-up')
                    pSim.setAttribute('position',pos);
                    pSim.classList.add('clickable');
                    pSim.setAttribute('animation',{property:"scale",startEvents:"click",dur:300,easing:"linear"});
                    pSim.addEventListener('click',function(){
                            scene.removeChild(pSim);
                            scene.removeChild(pNao);
                            scene.removeChild(pRep);
                            anjo.emit("positive");
                        //document.emit('keydown',{keyCode:'s'});
                    });
                    scene.appendChild(pSim);
                    
                    
                    //pos.x+=0.4;
                    //pos.z+=0.3;
                    pos.x+=0.04
                    pNao.setAttribute('visible',true);
                    pNao.setAttribute('id','op_nao');
                    pNao.setAttribute('scale',"0.04 0.04 0.04");
                    //pNao.setAttribute('material','color','#FF0000');
                    pNao.setAttribute('src','#thumbs-down')
                    pNao.setAttribute('position',pos);
                    pNao.classList.add('clickable');
                    pNao.setAttribute('animation',{property:"scale",startEvents:"click",dur:300,easing:"linear"});
                    pNao.addEventListener('click',function(){
                            scene.removeChild(pNao);
                            scene.removeChild(pSim);
                            scene.removeChild(pRep);
                            anjo.emit("negative");
                        //document.emit('keydown',{keyCode:'n'});
                    });
                    scene.appendChild(pNao);
                    pos.x+=0.04
                    //pos.x+=0.4;
                    //pos.z+=0.3;
                    
                    pRep.setAttribute('visible',true);
                    pRep.setAttribute('id','op_rep');
                    pRep.setAttribute('scale',"0.04 0.04 0.04");
                   // pRep.setAttribute('material','color','#AAAA00');
                     pRep.setAttribute('src','#repeat')
                    pRep.setAttribute('position',pos);
                    pRep.classList.add('clickable');
                    pRep.setAttribute('animation',{property:"scale",startEvents:"click",dur:300,easing:"linear"});
                    pRep.addEventListener('click',function(){
                            scene.removeChild(pNao);
                            scene.removeChild(pSim);
                            scene.removeChild(pRep);
                            anjo.emit("get-last-question");
                        //document.emit('keydown',{keyCode:'n'});
                    });
                    scene.appendChild(pRep);
                    
                });
            }
        });
      </script>
  </head>
  <body>
    <script>
        document.addEventListener('keydown', function(event) {
            var anjo = document.querySelector('#anjo');
            var porta = document.querySelector('#porta');
            switch(event.keyCode)
                {
                    case 83:
                        console.log("resposta positiva");
                        anjo.emit("positive");
                        if(PsoundIndex == 3) // max
                            getNextSound("question");
                        break;
                    case 78:
                        console.log("resposta negativa");
                        anjo.emit("negative");
                        break;
                    case 81:
                        console.log("pergunta");
                        anjo.emit("pergunta");
                        break;
                    case 90:
                        porta.emit('open');
                        break;
                    case 88:
                        porta.emit('close');
                        break;
                        
                }
          document.querySelectorAll('.listenonkey').forEach(function(obj){
            obj.setAttribute('position', '0 0 0');
          });
        });
    </script>
    <a-scene physics="gravity:0" inspector-plugin-recast id="cena">
      <a-assets>
          <img id="chao" src="modelos/ground/grass.jpg">
          <a-asset-item id="casa" src="modelos/apartment/apartamento-sem-porta.obj"></a-asset-item>
          <a-asset-item id="casa-mtl" src="modelos/apartment/apartamento-sem-porta.mtl"></a-asset-item>
          <a-asset-item id="house" src="modelos/house_by_vrdayminsk_Maria_Tkachenko/model.gltf" scale="15 15 15" position= "30 -15.3 0"></a-asset-item>
          <a-asset-item id="porta-obj" src="modelos/apartment/porta.obj"></a-asset-item>
          <a-asset-item id="porta-mtl" src="modelos/apartment/porta.mtl"></a-asset-item>
          <a-asset-item id="model-tunel" src="modelos/arc_tunnel/scene.gltf"></a-asset-item>
          <a-asset-item id="quarto" src="modelos/room_by_poly_by_google/Isometric_Room_03.gltf"></a-asset-item>
          <audio id="intro_anjo" src="audio/intro_anjo.mp3" ></audio>
          <audio id="anjo_p1" src="audio/anjo_fala_pos_1.mp3"></audio>
          <audio id="anjo_p2" src="audio/anjo_fala_pos_2.mp3"></audio>
          <audio id="anjo_p3" src="audio/anjo_fala_pos_3.mp3"></audio>
          <audio id="anjo_n1" src="audio/anjo_fala_neg_1.mp3"></audio>
          <audio id="anjo_q1" src="audio/anjo_fala_pergunta_1.mp3"></audio>
          <audio id="anjo_q2" src="audio/anjo_fala_pergunta_2.mp3"></audio>
          <audio id="knock_door" src="audio/knock_door.mp3" preload="auto"></audio>
          <a-img id="icone-play" src="icones_flaticon_freepik/play.png"></a-img>
          <a-img id="icone-pause" src="icones_flaticon_freepik/pause.png"></a-img>
          <a-img id="icone-avanco" src="icones_flaticon_freepik/fast-forward.png"></a-img>
          <a-img id="icone-anjo" src="icones_flaticon_freepik/angel.png"></a-img>
          <a-asset-item id="model-anjo" src="modelos/angelwings_V2_L2.123c61a56ce9-4551-4fef-81fc-258304213a57/12147_angelwings_V2_L2.obj"></a-asset-item>
          <a-asset-item id="mtl-anjo" src="modelos/angelwings_V2_L2.123c61a56ce9-4551-4fef-81fc-258304213a57/12147_angelwings_V2_L2.mtl"></a-asset-item>
          <a-img id="icone-cor" src="icones_flaticon_freepik/colour.png"></a-img>
          <a-asset-item id="prima-gltf" src="modelos/npc/stefani3.glb"></a-asset-item>
          <a-img id="icone-animation" src="icones_flaticon_freepik/animation.png"></a-img>
          <a-img id="footsteps" src="textures/footsteps.png"></a-img>
          <a-img id="thumbs-up" src="icones_flaticon_freepik/icons8-boa-qualidade-64.png"></a-img>
          <a-img id="thumbs-down" src="icones_flaticon_freepik/icons8-polegares-para-baixo-64.png"></a-img>
          <a-img id="repeat" src="icones_flaticon_freepik/icons8-repetir-64.png"></a-img>
          <a-img id="cenario" src="textures/painel-mega-banner-festa-cenario-vila-turma-do-chaves-3x2-D_NQ_NP_656824-MLB29098261117_012019-F.jpg"></a-img>
      </a-assets>
      <a-sky id="ceu" sound="src:#knock_door;loop:false;"color="#87ceeb"></a-sky>
        
        <!-- Câmera do Usuário -->
        <!-- Camera Rig -->
        <a-entity id="rig" animation="property:position;startEvents:go;">
            <!-- Camera -->
            <a-entity id="player" camera look-controls position="0 1.6 0" geometry="primitive:cylinder;radius:0.5;"  >
            
              <a-cursor id="cursor-player"
                animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
                animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
                animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 500; to: 1 1 1"
                fuse="true"
                material="color: blue; shader: flat"
                position="0 0 -0.3"
                geometry="primitive: ring"
                raycaster="objects: .clickable"
                >
              
              </a-cursor>
              <!-- Avatar Anjo -->
              <a-entity id="anjo" processa-resposta visible="false" sound="src:#intro_anjo" obj-model="obj:#model-anjo; mtl:#mtl-anjo;" position="2 0.3 -2" scale="0.002 0.002 0.002" rotation="-70 -60 0"
                        option-menu
                        animation="property:position;
                                   dur:1000;
                                   to:2 0.2 -2; 
                                   dir:alternate;
                                   loop:true;
                                   easing:linear;">
              </a-entity>
            </a-entity>
        </a-entity>
        
        <!-- Balão-->
        <a-sphere id="balao" color="#FF0000" position="-0.35 2 -8" scale="0.5 0.7 0.5" shadow="cast:true" visible = "true"
            animation__1 = "property: scale; 
                            to: 1.5 1.7 1.5; 
                            dur: 4000; easing:easeInOutCirc; 
                            dir: alternate;
                            loop:true;"
                  > <!-- dur e easing podem alterados pré-sessão -->
        </a-sphere>
        
        
        
        <!-- Menu 3D do Psicólogo -->
        <a-entity static-body id="menu" rotation="0 0 -50" position="-3 0 2">
            <a-entity text="color:#FFFFFF;
                            value:MENU DO PSICOLOGO;
                            wrap-count:18;" position="-1.3 0.6" rotation="-90 0 90 90"></a-entity>
            <!-- Caixa do Menu -->
            <a-box height="0.2" depth="1.5" color="gray" position=" -1 0.5 0">
                <a-entity position="0 0.1 0">
                    <!-- Botão Avançar -->
                    <a-sphere id="bt-avancar"
                              class="clickable"
                              position="0.1 -0.03 -0.5" src="#icone-avanco"
                              scale="0.1 0.15 0.15"
                              rotation="0 0 90"
                              button
                              transition>
                    </a-sphere>
                    <!-- Botão Pause -->
                    <a-sphere id="bt-pause"
                              class="clickable"
                          position="0.1 -0.03 -0.15" 
                          src="#icone-pause"
                          rotation="0 0 90"
                          scale="0.1 0.15 0.15"
                          button
                          pause>
                    </a-sphere>
                    <!-- Botão Play -->
                    <a-sphere id="bt-play"
                              class="clickable"
                              position="0.1 -0.03 0.2" src="#icone-play"
                              scale="0.1 0.15 0.15"
                              rotation="0 0 90"
                              button
                              play>
                    </a-sphere>
                    <!-- Botão Anjo -->
                <a-sphere id="bt-anjo"
                          class="clickable" 
                          position="0.1 -0.03 0.55" src="#icone-anjo"
                          scale="0.1 0.15 0.15"
                          rotation="0 0 90"
                          button
                          ativa_anjo>
                    </a-sphere>
                </a-entity>
             </a-box>
        </a-entity>
        
        <!-- Menu 3D do Paciente -->
        <a-entity static-body id="menu" rotation="0 0 -50" position="-3 0 0">
            <a-entity text="color:#FFFFFF;
                            value:MENU DO PACIENTE;
                            wrap-count:18;" position="-1.3 0.6 " rotation="-90 0 90 90"></a-entity>
            <!-- Caixa do Menu -->
            <a-box height="0.2" depth="1.5" color="gray" position=" -1 0.5 0">
                <a-entity position="0 0.1 0">
                    <!-- Botão Trocar Cor do Balão -->
                    <a-sphere id="bt-cor" class="clickable" 
                          position="0.1 -0.03 0.55" src="#icone-cor"
                          scale="0.1 0.15 0.15"
                          rotation="0 0 90"
                          button
                          muda-cor-balao>
                    </a-sphere>
                </a-entity>
             </a-box>
        </a-entity>
        
        <!-- Checkpoints -->
        <a-plane id="placa-1" visible="" desativa-portal="" src="#footsteps" scale="0.7 0.7 0.7" position="-0.59802 0.01 -5.76847" rotation="-90 0 0" class="clickable" goto="NaN" material="" geometry="">
		</a-plane>
        <a-plane id="placa-1-2" visible="" desativa-portal="" src="#footsteps" scale="0.7 0.7 0.7" position="0.01991 0.01 -0.17536" rotation="-90 0 0" class="clickable" goto="NaN" material="" geometry="">
		</a-plane>
        <a-plane id="placa-2" visible="true" desativa-portal src="#footsteps" scale="0.7 0.7 0.7" position="6.79846 0.01 -0.8" rotation="-90 0 0" class="clickable" goto>
		</a-plane>
        <a-plane id="placa-3" visible="true" ativa-portal src="#footsteps" scale="0.7 0.7 0.7" position="6.79846 0.01 -7.97443" rotation="-90 0 0" class="clickable" goto >
        </a-plane>
        <a-plane id="placa-4" visible="" ativa-porta="" emite-pergunta="" src="#footsteps" scale="0.7 0.7 0.7" rotation="-90 90 0" position="-12.84816 -19.94244 -1.36116"  class="clickable" goto="NaN" material="" geometry="">
		</a-plane>
        <a-plane id="placa-5" visible="" src="#footsteps" scale="0.7 0.7 0.7" rotation="-90 180 0" position="-12.42229 -19.94244 1.65502" class="clickable" goto="NaN" material="" geometry="">
		</a-plane>
        <a-plane id="placa-6" visible="" src="#footsteps" scale="0.7 0.7 0.7" rotation="-90 270 0" position="-9.00198 -19.94244 -1.42" class="clickable" goto="NaN" material="" geometry="">
		</a-plane>
        <a-plane id="placa-7" visible=""  src="#footsteps" scale="0.7 0.7 0.7" rotation="-90 90 0" position="-16.63332 -19.94244 -1.36116" class="clickable" goto="NaN" material="" geometry="">
		</a-plane>
        <a-plane id="placa-8" visible=""  src="#footsteps" scale="0.7 0.7 0.7" rotation="-90 0 0" position="-16.63332 -19.94244 -8.5195" class="clickable" goto="NaN" material="" geometry="">
		</a-plane>
        <a-plane id="placa-9" visible=""  src="#footsteps" scale="0.7 0.7 0.7" rotation="-90 0 0" position="-16.63332 -19.94244 -15.69136" class="clickable" goto="NaN" material="" geometry="">
		</a-plane>
        
        <!-- Túnel -->
        <a-entity id="tunel" gltf-model="#model-tunel" position="7 0 -6" scale="0.01 0.01 0.03">
            <a-box id="fundo" src="textures/cena.png" transicao-clinica height="270" width="300" position="1 120 -100">
            </a-box>
        </a-entity>
        
        <!-- Fase Clínica-->
        <a-entity static-body visible="true" id="clinico" position="-10 -20 0" obj-model="obj:#casa; mtl: #casa-mtl;">
            <!-- NPC -->
            <a-entity id="prima" gltf-model="modelos/npc/stefani2.glb" npc="" animation-mixer="clip: Idle" scale="0.5 0.5 0.5" position="-5.00727 0 -1.1" rotation="0 90 0">
            </a-entity>
            <a-cylinder door-controls rotation="0 0 0" id="door-axis" color="red" height="1.5" radius="0.001" position="-3.8 1 -1.8">
                <a-entity door-controls id="porta" obj-model="obj:#porta-obj;mtl:#porta-mtl;" position="0.1 -1 0.45" scale="1.2 0.97 1"
                          ></a-entity>
            </a-cylinder>
            <a-entity id="novo" visible="false" geometry="primitive:sphere" position="0 1.6 -1" goto></a-entity>
            <a-plane src="textures/FloorStreets0100_1_350.jpg" repeat="10 10" rotation="-90 0 0" scale="5.99 22.17 2.9" position="-6.792 0 -7.705"></a-plane>
            <a-entity id="tunel-2" gltf-model="#model-tunel" position="-6.68256 -0.19484 -13.69743" scale="0.01 0.01 0.03">
                <a-box id="fundo2" src="textures/cena.png" transicao-clinica height="270" width="300" position="1 120 -100">
                </a-box>
            </a-entity>
            <a-plane src="#cenario" position="-9 1.6 0" material="" geometry="" scale="8 3 5" rotation="0 90 0"></a-plane>
        </a-entity>
        
        <!-- Chão -->
        <a-plane  position="0 0 0" shadow="receive:true" src="#chao" repeat="50 50" rotation="-90 0 0" scale="20 20"></a-plane>
    </a-scene>
  </body>
</html>

